---
title: 第三章 VHDL语言基础
tags:
  - 大三上
  - 数字系统设计
date: 2025-09-15T10:00:00+08:00
summary: 本章学习VHDL语言的基础知识，构成了进行数字逻辑设计的基础框架。
---
###  VHDL 概述 📜

#### 1. 什么是VHDL？
*   **VHDL** 是 **<font color="orange">V</font>ery-<font color="orange">H</font>igh-<font color="orange">S</font>peed <font color="orange">I</font>ntegrated <font color="orange">C</font>ircuit <font color="orange">H</font>ardware <font color="orange">D</font>escription <font color="orange">L</font>anguage** 的缩写，即 **超高速集成电路硬件描述语言**。它是一种用于描述、建模和仿真数字电路的语言。

#### 2. VHDL的起源与发展 ⏳
*   **80年代初**：由美国国防部在实施 **超高速集成电路（VHSIC）** 项目时开发。
*   **1987年**：被IEEE协会批准为工业标准，称为 **IEEE1076-1987**。
*   **1993年**：更新为93标准，即 **IEEE1076.93**。
*   **1996年**：**IEEE1076.3** 成为综合标准。

#### 3. 使用VHDL的目的与用途 🎯
*   **目的**：将电子电路的设计思想以<font color="orange">文字或文件</font>的形式保存下来，方便他人理解和复用。
*   **用途**：主要用于描述数字系统的<font color="orange">结构、行为、功能和接口</font>。

#### 4. VHDL 与 Verilog HDL 的比较 🔄

| 特性     | 相同点 ✅                                                                  | 不同点 ❌                                                                                |
| :------- | :------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------- |
| **语言定位** | 都是主流的硬件描述语言。                                                   | VHDL语法严谨，类似Ada，较为晦涩；Verilog语法类似C语言，简单易用。                             |
| **抽象层次** | 都能从系统行为级、寄存器传输级(RTL)和门级进行电路描述。                    | VHDL侧重于<font color="orange">系统级</font>描述，更适合大型、复杂的系统设计；Verilog侧重于<font color="orange">电路级</font>描述，更适合具体的电路设计。 |
| **表示方式** | 都能以文本形式抽象地表示电路的行为和结构。                                 | 使用难度上，VHDL相对较大。                                                               |

#### 5. VHDL的特点 ✨
*   **系统硬件描述能力强**：能从高层到低层描述复杂的数字系统。
*   **与器件和工艺无关**：设计的可移植性好，不依赖于特定的芯片厂商或制造工艺。
*   **IEEE工业标准**：规范性好，通用性强。
*   **方法灵活，技术齐全**：支持多种设计方法和描述风格。
*   **可读性好**：代码结构清晰，易于理解和维护。
*   **核心特性**：VHDL具有<font color="orange">硬件特征</font>，其语句本质上是<font color="orange">并行执行</font>的。

---

### VHDL程序的基本结构 🏗️

一个完整的VHDL程序通常包含 **4** 个主要部分，此外还有一个可选的配置部分。

1.  **库 (Library) 的调用** 📚
    *   **作用**：相当于操作系统中的“目录”，存放预编译好的程序包和数据。
    *   **代码**：`LIBRARY IEEE;`

2.  **程序包 (Package) 的调用** 📦
    *   **作用**：类似于C语言中的 `include` 语句，用来声明在代码中将要使用的函数、数据类型、元件等。
    *   **代码**：`USE IEEE.std_logic_1164.all;`

3.  **实体 (Entity) 声明** 🚪
    *   **作用**：定义了设计单元的<font color="orange">外部接口</font>，即输入输出引脚。它描述了“这个模块长什么样”。
    *   **代码**：
        ```vhdl
        ENTITY MUX2 IS
            PORT ( ... );
        END ENTITY;
        ```

4.  **结构体 (Architecture) 描述** 🧠
    *   **作用**：描述实体的<font color="orange">内部功能和行为</font>。它回答了“这个模块如何工作”。一个实体可以有多个结构体。
    *   **代码**：
        ```vhdl
        ARCHITECTURE behav OF MUX2 IS
        BEGIN
            ...
        END behav;
        ```

5.  **配置 (Configuration) 部分** (可选) ⚙️
    *   **作用**：当一个实体有多个结构体时，用于指定具体使用哪一个结构体进行编译或仿真。

---

### VHDL程序的主要构件 🧩

#### 1. 库 (Library) 📖
库是存放预先编译好的程序包和数据集合体的仓库。

*   **STD库 (默认库)**：符合VHDL语言标准，包含`standard`程序包，定义了最基本的数据类型（如`BIT`, `INTEGER`, `BOOLEAN`等）。在应用中无需显式调用。
*   **IEEE库**：VHDL设计中最常用的库，<font color="orange">必须显式声明</font>。
    *   **`std_logic_1164`**：定义了`STD_LOGIC`和`STD_LOGIC_VECTOR`九值逻辑系统及相关函数。
    *   **`std_logic_arith`**：定义了`UNSIGNED`, `SIGNED`等数据类型及相关的算术运算。
    *   **`std_logic_signed` 和 `std_logic_unsigned`**：重载了运算符，支持`STD_LOGIC_VECTOR`与`INTEGER`等的混合运算。
*   **WORK库 (默认库)**：用户当前正在设计的库，用于存放当前设计和编译的单元。

#### 2. 包 (Package) 🎁
包声明类似于C语言的`include`，用于罗列VHDL代码中需要用到的信号、常数、数据类型、元件、函数等定义。
*   **使用格式**: `USE 库名.包名.all;`
*   **注意点** ⚠️：同样的VHDL语句，如果调用了不同的程序包，可能会生成功能相同但<font color="orange">电路结构完全不同</font>的设计。例如，一个包可能将与非门实现为标准CMOS电路，而另一个包可能实现为集电极开路电路。

#### 3. 实体 (Entity) 🖼️
实体定义了设计的外部接口。
*   **使用格式**:
    ```vhdl
    ENTITY 实体名 IS 
	    [ GENERIC (类属参数说明); ]
		[ PORT (端口说明); ] 
	END [ENTITY] [实体名];
    ```
*   **类属参数 `GENERIC`**：用于传递静态信息，如器件延迟、总线宽度等。
*   **端口 `PORT`**：定义输入输出引脚。格式为 `端口名: 端口方向 数据类型`。
    *   **端口方向**：
        *   `IN`: 输入
        *   `OUT`: 输出
        *   `INOUT`: 双向
        *   `BUFFER`: 缓冲输出（可读可写，但只能有一个驱动源）

#### 4. 结构体 (Architecture) 🛠️
结构体是设计实体的具体描述，指明其内部行为或结构。
*   **使用格式**:
    ```vhdl
	ARCHITECTURE 结构体名 OF 实体名 IS
	    [ 定义说明部分; ]
	BEGIN
	    [ 并行处理语句; ]
	END 结构体名;
    ```
*   **注意点** ⚠️：
    *   定义说明部分的声明（如信号、常量）只在本结构体内部有效。
    *   `BEGIN`后面的语句都是<font color="orange">并行</font>的。
*   **结构体的描述方法**:
    *   **行为描述 (Behavioral)**：使用`PROCESS`语句等，描述输入与输出之间的算法行为，不关心具体电路结构。
    *   **数据流描述 (Dataflow / RTL)**：使用并行信号赋值语句，描述数据在寄存器之间的流动和处理方式。
    *   **结构描述 (Structural)**：通过例化（`instantiation`）已有的元件并描述它们之间的连接关系来构成更复杂的设计，体现了<font color="orange">层次化设计</font>思想。

---

### VHDL数据类型及运算符 🧮

#### 1. 标准数据类型

| 数据类型       | 含义与用途                                                         |
| :------------- | :----------------------------------------------------------------- |
| **整数 `INTEGER`**   | 32位整数，常用于计数或总线宽度定义。                           |
| **实数 `REAL`**      | 浮点数，主要用于仿真，不可综合。                               |
| **位 `BIT`**         | 逻辑 '0' 或 '1'。                                              |
| **位矢量 `BIT_VECTOR`** | `BIT`的数组，如 `BIT_VECTOR(7 DOWNTO 0)`。                     |
| **布尔 `BOOLEAN`**   | `TRUE` 或 `FALSE`。                                            |
| **字符 `CHARACTER`** | ASCII码字符，如 'a'。                                          |
| **字符串 `STRING`**  | 字符数组，如 "hello"。                                         |
| **时间 `TIME`**      | 物理量，带单位（fs, ps, ns, us, ms, sec）。用于仿真。        |
| **错误等级 `SEVERITY`** | NOTE, WARNING, ERROR, FAILURE。用于仿真提示。                  |

#### 2. 用户自定义数据类型
*   **枚举类型**：列出所有可能的值。常用于状态机状态定义。
    `TYPE state IS (idle, s1, s2, s3);`
*   **子类型**：基于现有类型定义一个范围约束。
    `SUBTYPE my_int IS INTEGER RANGE 0 TO 255;`
*   **数组类型**：将相同数据类型的元素集合在一起。
    `TYPE data_bus IS ARRAY(31 DOWNTO 0) OF STD_LOGIC;`

#### 3. 数据类型转换 🔄
VHDL是强类型语言，不同数据类型间赋值需要<font color="orange">显式转换</font>。IEEE库提供了丰富的转换函数，如：
*   `CONV_INTEGER(A)`: 将`UNSIGNED`或`SIGNED`类型转换为`INTEGER`。
*   `TO_STDLOGICVECTOR(A)`: 将`BIT_VECTOR`转换为`STD_LOGIC_VECTOR`。

#### 4. 运算符与优先级
VHDL运算符有优先级之分，从高到低排列如下：
*   🔼 **最高**：`**`, `ABS`, `NOT` (指数, 绝对值, 逻辑非)
*   🔼 **乘法类**：`*`, `/`, `MOD`, `REM`
*   🔼 **正负号**：`+`, `-`
*   🔼 **加法与并置**：`+`, `-`, `&`
*   🔽 **关系类**：`=`, `/=`, `<`, `<=`, `>`, `>=`
*   🔽 **最低**：`AND`, `OR`, `NAND`, `NOR`, `XOR`, `XNOR`

---

### VHDL的数据对象 📦

数据对象是VHDL中可以被赋值的客体。

| 数据对象 | 定义                                       | 赋值符号 | 生效时间 | 作用域       | 硬件对应          |
| :------- | :----------------------------------------- | :------- | :------- | :----------- | :---------------- |
| **常量 `CONSTANT`** | 设计中不变的值。                           | `:=`     | -        | 全局         | 固定连接（如电源） |
| **变量 `VARIABLE`** | 进程或子程序中的<font color="orange">临时</font>存储。   | `:=`     | 立即生效 | 局部         | 无（计算中间量）  |
| **信号 `SIGNAL`**   | 描述硬件实体间的<font color="orange">物理连线</font>。 | `<=`     | 延时生效 | 全局/局部    | 导线、寄存器输出  |

*   **易错点** 💥：**变量** 和 **信号** 的区别是VHDL学习中的核心与难点！
    *   变量赋值 (`:=`) 是 **立即** 的，在同一时钟周期内，后面的语句马上能用到更新后的值。
    *   信号赋值 (`<=`) 是 **延时** 的（或称调度赋值），它的值要到进程下一次启动或特定延时后才更新。在同一个进程中，本次赋的新值在进程结束前是不可见的。
    *   **变量**只能在进程和子程序内部声明和使用，是局部量。
    *   **信号**可以在结构体中声明，是全局信号，用于连接不同的进程和模块。

---

### VHDL基本语句 📝

VHDL语句分为两类：并行语句和顺序语句。

#### 1. 并行语句 (Concurrent Statements) ⏸️⏸️
在结构体中，`BEGIN`之后的所有语句都是并行的，它们的执行与书写顺序无关。

*   **进程语句 `PROCESS`**: 是并行语句中的“容器”，其内部封装的是<font color="orange">顺序语句</font>。
*   **信号赋值语句**:
    *   **简单赋值**: `q <= d;`
    *   **条件赋值**: `z <= a WHEN sel='1' ELSE b;`
    *   **选择赋值**: `WITH sel SELECT q <= a WHEN "00", b WHEN "01", ...;`
*   **元件例化语句**: `U1: entity_name PORT MAP (port1 => sig1, ...);`

#### 2. 顺序语句 (Sequential Statements) 🔽🔽
只能出现在<font color="orange">进程或子程序</font>内部，按书写顺序依次执行。

*   **变量赋值语句**: `v := v + 1;`
*   **IF 语句**:
    ```vhdl
    IF condition THEN
        -- statements
    ELSIF condition THEN
        -- statements
    ELSE
        -- statements
    END IF;
    ```
*   **CASE 语句**:
    ```vhdl
    CASE expression IS
        WHEN choice1 => -- statements
        WHEN choice2 => -- statements
        WHEN OTHERS => -- statements
    END CASE;
    ```
    *   **注意点** ⚠️：`CASE`语句的条件选择必须<font color="orange">完备</font>，如果不能列出所有可能，必须用`WHEN OTHERS`来覆盖其余情况。
*   **LOOP 语句**:
    *   `FOR ... LOOP ... END LOOP;`
    *   `WHILE ... LOOP ... END LOOP;`

---

### 本章学习总结 🎓

本章我们学习了VHDL语言的基础知识，构成了进行数字逻辑设计的基础框架。

1.  **VHDL程序结构** 🏛️：一个完整的VHDL程序由**库调用、包调用、实体和结构体**四部分组成。实体定义外部接口，结构体描述内部功能，这是VHDL模块化设计的核心。
2.  **数据对象** 📊：深刻理解**常量（Constant）、变量（Variable）和信号（Signal）** 的区别至关重要，尤其是变量的立即赋值 `:=` 和信号的延时赋值 `<=` 是理解VHDL行为的关键。
3.  **语句类型** 📜：VHDL的核心特性是 **并行**。我们必须清晰地区分只能在结构体中使用的 **并行语句** 和只能在进程/子程序中使用的 **顺序语句**。
4.  **描述风格** 🎨：掌握了 **行为、数据流和结构化** 三种描述风格，可以根据设计需求灵活选择最合适的方式来描述电路。
5.  **核心构件** 🧱：理解了 **库、包、实体、结构体、函数、过程** 等主要构件的作用和语法，是编写正确且高效VHDL代码的前提。

通过本章的学习，我们已经掌握了使用VHDL来描述一个基本数字逻辑模块所需的全部要素。